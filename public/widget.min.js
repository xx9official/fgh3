(function(){"use strict";class ZYMOConfig{constructor(){this.siteId=null;this.primaryColor="#0099ff";this.position="right";this.theme="light";this.title="Chat with us";this.baseUrl=window.location.protocol+"//"+window.location.hostname+":5000";this.isOpen=false;this.isConnected=false;this.unreadCount=0;this.messages=[];this.currentSupporter=null;this.typingTimeout=null;this.loadFromScript();this.loadFromLocalStorage()}loadFromScript(){const script=document.currentScript||document.querySelector("script[data-site-id]");if(script){this.siteId=script.getAttribute("data-site-id");this.primaryColor=script.getAttribute("data-primary-color")||this.primaryColor;this.position=script.getAttribute("data-position")||this.position;this.theme=script.getAttribute("data-theme")||this.theme;this.title=script.getAttribute("data-title")||this.title}}loadFromLocalStorage(){try{const saved=localStorage.getItem(`zymo_${this.siteId}`);if(saved){const data=JSON.parse(saved);this.isOpen=data.isOpen||false;this.messages=data.messages||[];this.unreadCount=data.unreadCount||0}}catch(e){console.warn("ZYMO: Could not load saved state")}}saveToLocalStorage(){try{const data={isOpen:this.isOpen,messages:this.messages,unreadCount:this.unreadCount,timestamp:Date.now()};localStorage.setItem(`zymo_${this.siteId}`,JSON.stringify(data))}catch(e){console.warn("ZYMO: Could not save state")}}}const ZYMO_STYLES=`.zymo-widget{position:fixed;z-index:999999;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;font-size:14px;line-height:1.4;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.zymo-widget *{box-sizing:border-box}.zymo-widget.zymo-position-right{right:20px;bottom:20px}.zymo-widget.zymo-position-left{left:20px;bottom:20px}.zymo-chat-button{width:60px;height:60px;border-radius:50%;background:var(--zymo-primary-color,#0099ff);color:white;border:none;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.15);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:flex;align-items:center;justify-content:center;position:relative;outline:none}.zymo-chat-button:hover{transform:scale(1.1);box-shadow:0 6px 25px rgba(0,0,0,0.2)}.zymo-chat-button:focus{box-shadow:0 0 0 3px rgba(0,153,255,0.3)}.zymo-chat-button svg{width:24px;height:24px;transition:transform 0.2s ease}.zymo-chat-button:hover svg{transform:scale(1.1)}.zymo-unread-badge{position:absolute;top:-5px;right:-5px;background:#ff4757;color:white;border-radius:50%;width:20px;height:20px;font-size:11px;font-weight:600;display:flex;align-items:center;justify-content:center;animation:zymo-pulse 2s infinite}@keyframes zymo-pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}.zymo-chat-window{position:absolute;bottom:80px;width:380px;height:600px;background:white;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.15);display:flex;flex-direction:column;overflow:hidden;opacity:0;transform:scale(0.8) translateY(20px);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);border:1px solid rgba(0,0,0,0.1)}.zymo-widget.zymo-position-left .zymo-chat-window{left:0}.zymo-widget.zymo-position-right .zymo-chat-window{right:0}.zymo-chat-window.zymo-open{opacity:1;transform:scale(1) translateY(0)}.zymo-header{background:var(--zymo-primary-color,#0099ff);color:white;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;min-height:60px}.zymo-header-left{display:flex;align-items:center;gap:12px;flex:1}.zymo-avatar{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:16px}.zymo-header-info{flex:1}.zymo-title{font-weight:600;font-size:16px;margin:0;line-height:1.2}.zymo-subtitle{font-size:12px;opacity:0.9;margin:2px 0 0 0}.zymo-status{display:flex;align-items:center;gap:6px;font-size:12px}.zymo-status-dot{width:8px;height:8px;border-radius:50%;background:#4ade80}.zymo-status-dot.zymo-offline{background:#94a3b8}.zymo-close-button{background:none;border:none;color:white;cursor:pointer;padding:8px;border-radius:6px;transition:background-color 0.2s;display:flex;align-items:center;justify-content:center}.zymo-close-button:hover{background:rgba(255,255,255,0.1)}.zymo-messages{flex:1;padding:20px;overflow-y:auto;background:#f8fafc;scroll-behavior:smooth}.zymo-messages::-webkit-scrollbar{width:6px}.zymo-messages::-webkit-scrollbar-track{background:transparent}.zymo-messages::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.1);border-radius:3px}.zymo-message{margin-bottom:16px;display:flex;flex-direction:column}.zymo-message.zymo-visitor{align-items:flex-end}.zymo-message.zymo-supporter{align-items:flex-start}.zymo-message-bubble{max-width:80%;padding:12px 16px;border-radius:18px;font-size:14px;line-height:1.4;word-wrap:break-word;position:relative}.zymo-message.zymo-visitor .zymo-message-bubble{background:var(--zymo-primary-color,#0099ff);color:white;border-bottom-right-radius:6px}.zymo-message.zymo-supporter .zymo-message-bubble{background:white;color:#1f2937;border:1px solid #e5e7eb;border-bottom-left-radius:6px}.zymo-message-time{font-size:11px;color:#6b7280;margin-top:4px;text-align:center}.zymo-message.zymo-visitor .zymo-message-time{text-align:right}.zymo-message.zymo-supporter .zymo-message-time{text-align:left}.zymo-typing{display:flex;align-items:center;gap:8px;padding:12px 16px;background:white;border:1px solid #e5e7eb;border-radius:18px;max-width:80%;margin-bottom:16px}.zymo-typing-dots{display:flex;gap:4px}.zymo-typing-dot{width:6px;height:6px;border-radius:50%;background:#9ca3af;animation:zymo-typing 1.4s infinite ease-in-out}.zymo-typing-dot:nth-child(1){animation-delay:-0.32s}.zymo-typing-dot:nth-child(2){animation-delay:-0.16s}@keyframes zymo-typing{0%,80%,100%{transform:scale(0.8);opacity:0.5}40%{transform:scale(1);opacity:1}}.zymo-input-area{padding:20px;background:white;border-top:1px solid #e5e7eb}.zymo-input-container{display:flex;gap:12px;align-items:flex-end}.zymo-input{flex:1;border:1px solid #d1d5db;border-radius:24px;padding:12px 16px;font-size:14px;outline:none;transition:border-color 0.2s;resize:none;min-height:44px;max-height:120px;font-family:inherit}.zymo-input:focus{border-color:var(--zymo-primary-color,#0099ff)}.zymo-send-button{background:var(--zymo-primary-color,#0099ff);color:white;border:none;border-radius:50%;width:44px;height:44px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;flex-shrink:0}.zymo-send-button:hover{transform:scale(1.05)}.zymo-send-button:disabled{opacity:0.5;cursor:not-allowed;transform:none}.zymo-send-button svg{width:18px;height:18px}.zymo-footer{padding:12px 20px;background:#f8fafc;border-top:1px solid #e5e7eb;text-align:center}.zymo-powered-by{font-size:11px;color:#6b7280;text-decoration:none}.zymo-powered-by:hover{color:var(--zymo-primary-color,#0099ff)}.zymo-welcome{text-align:center;color:#6b7280;padding:40px 20px}.zymo-welcome-icon{width:48px;height:48px;margin:0 auto 16px;background:var(--zymo-primary-color,#0099ff);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white}.zymo-welcome-title{font-weight:600;font-size:16px;margin:0 0 8px 0;color:#1f2937}.zymo-welcome-text{font-size:14px;line-height:1.5;margin:0}.zymo-loading{display:flex;align-items:center;justify-content:center;padding:40px 20px;color:#6b7280}.zymo-spinner{width:20px;height:20px;border:2px solid #e5e7eb;border-top:2px solid var(--zymo-primary-color,#0099ff);border-radius:50%;animation:zymo-spin 1s linear infinite;margin-right:8px}@keyframes zymo-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.zymo-widget.zymo-theme-dark{--zymo-bg-primary:#1f2937;--zymo-bg-secondary:#374151;--zymo-text-primary:#f9fafb;--zymo-text-secondary:#d1d5db;--zymo-border:#4b5563}.zymo-widget.zymo-theme-dark .zymo-chat-window{background:var(--zymo-bg-primary);border-color:var(--zymo-border)}.zymo-widget.zymo-theme-dark .zymo-messages{background:var(--zymo-bg-secondary)}.zymo-widget.zymo-theme-dark .zymo-message.zymo-supporter .zymo-message-bubble{background:var(--zymo-bg-primary);color:var(--zymo-text-primary);border-color:var(--zymo-border)}.zymo-widget.zymo-theme-dark .zymo-input-area{background:var(--zymo-bg-primary);border-top-color:var(--zymo-border)}.zymo-widget.zymo-theme-dark .zymo-input{background:var(--zymo-bg-secondary);border-color:var(--zymo-border);color:var(--zymo-text-primary)}.zymo-widget.zymo-theme-dark .zymo-footer{background:var(--zymo-bg-secondary);border-top-color:var(--zymo-border)}@media (max-width:480px){.zymo-chat-window{width:calc(100vw - 40px);height:calc(100vh - 120px);bottom:80px;left:20px!important;right:20px!important}.zymo-widget.zymo-position-left .zymo-chat-window,.zymo-widget.zymo-position-right .zymo-chat-window{left:20px!important;right:20px!important}}.zymo-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.zymo-chat-button:focus-visible,.zymo-close-button:focus-visible,.zymo-send-button:focus-visible{outline:2px solid var(--zymo-primary-color,#0099ff);outline-offset:2px}`;class ZYMOWidget{constructor(){this.config=new ZYMOConfig();this.elements={};this.socket=null;if(!this.config.siteId){console.error("ZYMO Widget: Site ID is required");return}this.init()}init(){this.injectStyles();this.createWidget();this.bindEvents();this.loadState();this.connectWebSocket()}injectStyles(){if(document.getElementById("zymo-styles"))return;const style=document.createElement("style");style.id="zymo-styles";style.textContent=ZYMO_STYLES;document.head.appendChild(style)}createWidget(){const widget=document.createElement("div");widget.id="zymo-widget";widget.className=`zymo-widget zymo-position-${this.config.position} zymo-theme-${this.config.theme}`;widget.style.setProperty("--zymo-primary-color",this.config.primaryColor);widget.innerHTML=this.getWidgetHTML();document.body.appendChild(widget);this.elements={widget,chatButton:widget.querySelector(".zymo-chat-button"),chatWindow:widget.querySelector(".zymo-chat-window"),messages:widget.querySelector(".zymo-messages"),input:widget.querySelector(".zymo-input"),sendButton:widget.querySelector(".zymo-send-button"),closeButton:widget.querySelector(".zymo-close-button"),unreadBadge:widget.querySelector(".zymo-unread-badge"),title:widget.querySelector(".zymo-title"),subtitle:widget.querySelector(".zymo-subtitle"),statusDot:widget.querySelector(".zymo-status-dot")}}getWidgetHTML(){return`<button class="zymo-chat-button" aria-label="Open chat" role="button" tabindex="0"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg><span class="zymo-unread-badge" style="display: none;">0</span></button><div class="zymo-chat-window" role="dialog" aria-label="Chat window" aria-hidden="true"><div class="zymo-header"><div class="zymo-header-left"><div class="zymo-avatar">💬</div><div class="zymo-header-info"><h3 class="zymo-title">${this.config.title}</h3><div class="zymo-subtitle"><span class="zymo-status"><span class="zymo-status-dot"></span><span class="zymo-status-text">Online</span></span></div></div></div><button class="zymo-close-button" aria-label="Close chat" role="button" tabindex="0"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 19 17.59 13.41 12z"/></svg></button></div><div class="zymo-messages" role="log" aria-live="polite"><div class="zymo-welcome"><div class="zymo-welcome-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div><h4 class="zymo-welcome-title">Welcome!</h4><p class="zymo-welcome-text">How can we help you today?</p></div></div><div class="zymo-input-area"><div class="zymo-input-container"><textarea class="zymo-input" placeholder="Type your message..." rows="1" aria-label="Message input" role="textbox"></textarea><button class="zymo-send-button" aria-label="Send message" role="button" tabindex="0"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button></div></div><div class="zymo-footer"><a href="https://zymo.chat" target="_blank" rel="noopener" class="zymo-powered-by">Powered by ZYMO</a></div></div>`}bindEvents(){this.elements.chatButton.addEventListener("click",()=>this.toggleChat());this.elements.chatButton.addEventListener("keydown",(e)=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();this.toggleChat()}});this.elements.closeButton.addEventListener("click",()=>this.closeChat());this.elements.closeButton.addEventListener("keydown",(e)=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();this.closeChat()}});this.elements.sendButton.addEventListener("click",()=>this.sendMessage());this.elements.input.addEventListener("keydown",(e)=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();this.sendMessage()}});this.elements.input.addEventListener("input",()=>this.resizeInput());document.addEventListener("keydown",(e)=>{if(e.key==="Escape"&&this.config.isOpen){this.closeChat()}});document.addEventListener("click",(e)=>{if(this.config.isOpen&&!this.elements.widget.contains(e.target)){this.closeChat()}})}toggleChat(){if(this.config.isOpen){this.closeChat()}else{this.openChat()}}openChat(){this.config.isOpen=true;this.elements.chatWindow.classList.add("zymo-open");this.elements.chatWindow.setAttribute("aria-hidden","false");this.elements.input.focus();this.clearUnreadCount();this.config.saveToLocalStorage()}closeChat(){this.config.isOpen=false;this.elements.chatWindow.classList.remove("zymo-open");this.elements.chatWindow.setAttribute("aria-hidden","true");this.config.saveToLocalStorage()}sendMessage(){const message=this.elements.input.value.trim();if(!message)return;this.addMessage(message,"visitor");this.elements.input.value="";this.resizeInput();this.sendToServer(message);setTimeout(()=>{this.addMessage("Thanks for your message! We'll get back to you soon.","supporter")},1000)}addMessage(text,sender,timestamp=new Date()){const message={id:Date.now()+Math.random(),text,sender,timestamp};this.config.messages.push(message);this.renderMessage(message);this.scrollToBottom();this.config.saveToLocalStorage()}renderMessage(message){const messageEl=document.createElement("div");messageEl.className=`zymo-message zymo-${message.sender}`;messageEl.setAttribute("data-message-id",message.id);const time=new Date(message.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});messageEl.innerHTML=`<div class="zymo-message-bubble">${this.escapeHtml(message.text)}</div><div class="zymo-message-time">${time}</div>`;this.elements.messages.appendChild(messageEl)}renderMessages(){this.elements.messages.innerHTML="";if(this.config.messages.length===0){this.elements.messages.innerHTML=`<div class="zymo-welcome"><div class="zymo-welcome-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div><h4 class="zymo-welcome-title">Welcome!</h4><p class="zymo-welcome-text">How can we help you today?</p></div>`}else{this.config.messages.forEach(message=>this.renderMessage(message))}}loadState(){this.renderMessages();if(this.config.isOpen){this.openChat()}this.updateUnreadBadge()}updateUnreadBadge(){if(this.config.unreadCount>0){this.elements.unreadBadge.style.display="flex";this.elements.unreadBadge.textContent=this.config.unreadCount>99?"99+":this.config.unreadCount}else{this.elements.unreadBadge.style.display="none"}}clearUnreadCount(){this.config.unreadCount=0;this.updateUnreadBadge();this.config.saveToLocalStorage()}incrementUnreadCount(){this.config.unreadCount++;this.updateUnreadBadge();this.config.saveToLocalStorage()}scrollToBottom(){this.elements.messages.scrollTop=this.elements.messages.scrollHeight}resizeInput(){const input=this.elements.input;input.style.height="auto";input.style.height=Math.min(input.scrollHeight,120)+"px"}sendToServer(message){console.log("Sending message to server:",message)}connectWebSocket(){console.log("Connecting to WebSocket...")}escapeHtml(text){const div=document.createElement("div");div.textContent=text;return div.innerHTML}showTypingIndicator(){const typing=document.createElement("div");typing.className="zymo-typing";typing.innerHTML=`<div class="zymo-typing-dots"><div class="zymo-typing-dot"></div><div class="zymo-typing-dot"></div><div class="zymo-typing-dot"></div></div><span>Support is typing...</span>`;this.elements.messages.appendChild(typing);this.scrollToBottom()}hideTypingIndicator(){const typing=this.elements.messages.querySelector(".zymo-typing");if(typing){typing.remove()}}updateSupporter(supporter){this.config.currentSupporter=supporter;if(supporter){this.elements.title.textContent=supporter.name;this.elements.subtitle.innerHTML=`<span class="zymo-status"><span class="zymo-status-dot ${supporter.isOnline?"":"zymo-offline"}"></span><span class="zymo-status-text">${supporter.isOnline?"Online":"Offline"}</span></span>`}else{this.elements.title.textContent=this.config.title;this.elements.subtitle.innerHTML=`<span class="zymo-status"><span class="zymo-status-dot"></span><span class="zymo-status-text">Online</span></span>`}}}function initializeWidget(){try{new ZYMOWidget()}catch(error){console.error("ZYMO Widget initialization failed:",error)}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initializeWidget)}else{initializeWidget()}})(); 